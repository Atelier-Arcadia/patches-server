defmodule Patches.Vulnerability do
  @moduledoc """
  A description of a vulnerability that affects a software package.
  """

  defstruct(
    name: "",
    affected_package: "",
    affected_platform: "",
    details_href: "",
    severity: 0,
    fixed_in: []
  )
end

defmodule Patches.Vulnerability.Source do
  @moduledoc """
  A behaviour for modules capable of retrieving vulnerabilities for a platform,
  identified by a string.
  """

  @typedoc """
  Indicates successful retrieval of vulnerability information.

  The third `term` in the tuple should be the new state for the `Source`.
  """
  @type success :: {:ok, [Patches.Vulnerability], term}

  @typedoc """
  Indicates failure to retieve vulnerability information.
  """
  @type failure :: {:error, Atom.t}

  @doc """
  Initialize state state for the `Source`.

  The string argument is the name of the platform to retrieve vulns for.
  The integer argument is the number of vulns to retrieve per request.
  """
  @callback init(String.t, integer) :: term

  @doc """
  Retrieve more vulnerabilities.
  """
  @callback retrieve(term) :: success | failure
end
